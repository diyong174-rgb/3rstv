<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IPTV Player</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .video-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .fullscreen-btn {
      position: absolute;
      top: 10px;
      right: 50px;
      background-color: rgba(0, 0, 0, 0.5);
      color: #fff;
      border: none;
      padding: 10px;
      cursor: pointer;
      font-size: 20px;
      border-radius: 5px;
      z-index: 10;
    }

    .logo {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      background-image: url('https://i.ibb.co/nN0VGRY8/Chat-GPT-Image-Oct-4-2025-05-05-12-AM-1.png');  /* Updated logo URL */
      background-size: contain;
      background-repeat: no-repeat;
      z-index: 10;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    @media only screen and (max-width: 768px) {
      .video-container {
        max-width: 100%;
        max-height: 100%;
      }
      video {
        object-fit: contain;
      }
    }

    @media only screen and (min-width: 769px) {
      .video-container {
        max-width: 95%; /* Adjust video container size for larger screens */
        max-height: 95%;
      }
    }

    .movie-info {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 20px;
      z-index: 10;
    }

    .pg-info {
      position: absolute;
      bottom: 20px;
      right: 20px; /* Move it to the lower right */
      color: white;
      font-size: 20px;
      z-index: 10;
    }

    .ad-container {
      position: absolute;
      top: 10px; /* Move to upper left */
      left: 10px; /* Upper left position */
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 20px;
      font-size: 20px;
      display: none;
      z-index: 20;
    }

    .error-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.7);
      color: white;
      padding: 20px;
      font-size: 20px;
      display: none;
      z-index: 30;
    }
  </style>
  <!-- Include HLS.js for .m3u8 support -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
  <div class="video-container">
    <video id="videoPlayer" controls>
      <source id="videoSource" src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <button class="fullscreen-btn" onclick="toggleFullScreen()">üñ•Ô∏è</button>
    <div id="movieInfo" class="movie-info"></div>
    <div id="pgInfo" class="pg-info"></div> <!-- PG Info in lower right -->
    <div id="logo" class="logo"></div>
    <div id="adContainer" class="ad-container">
      <p>Ad Playing...</p>
    </div>
    <div id="errorMessage" class="error-message">
      <p>Sorry, this video cannot be played in your browser.</p>
    </div>
  </div>

  <script>
    // Sample movie list with .m3u8 and .mp4 formats
    const moviesList = [
      { src: "https://videos.gia.tv/giatv/movies/playlist/210273/Wang_Fam_2015_tt5209276_WD_480.mp4", title: "WangFam", isGiatv: true, pg: "Parental Guidance" },
      { src: "https://videos.gia.tv/giatv/movies/playlist/210631/Crawl_2019_720p_BluRay_x264_ESub_Hollymoviehd.mp4", title: "Crawl", isGiatv: true, pg: "Restricted" },
      { src: "https://jungotvmedia.chanall.tv/jungotv/SolarMayLamokSaKulamboTGFULL10mbps/playlist_720p.m3u8", title: "May Lamok sa loob ng Kulambo", isGiatv: false, pg: "General Audience" },
      { src: "https://jungotvmedia.chanall.tv/jungotv/SOLARKumakasaKahitNagiisaTGFULL10mbps/playlist_720p.m3u8", title: "Kumakasa kahit Mag-isa", isGiatv: false, pg: "Parental Guidance" },
      { src: "https://ph-en.plp4ytv14.workers.dev/nflx.mp4?file=aD5PSptcaGi07yH%2Be0am%2BImv96euKcVvnMrFzKUa4ALTA4PbJDebTbsOwAzD1RKo&expiry=oqFh%2B149Y%2BpyhYhZXMTrJQ%3D%3D&mac=ecdfaf3336cc44cb125aff33f4a378f686da12860995be86152009e5c29073ad", title: "2012", isGiatv: false, pg: "Parental Guidance" }
    ];

    const adsList = [
      { src: "https://videos.gia.tv/giatv/movies/playlist/210273/Coca_Cola___Happiness_Factory__2006__Netherlands_.mp4", title: "Ads" },
      { src: "https://videos.gia.tv/giatv/movies/playlist/210273/MARK_CIGARETTES___PHOTO_TVC_30s_HD.mp4", title: "Ads" }
    ];

    let currentMovieIndex = Math.floor(Math.random() * moviesList.length);
    let adIndex = 0;
    let hlsInstance = null;
    let isAdPlaying = false;

    const videoPlayer = document.getElementById('videoPlayer');
    const errorMessage = document.getElementById('errorMessage');
    const pgInfo = document.getElementById('pgInfo');  // PG Info Element

    // Generic error handler (remove pop-up)
    function handleVideoError() {
      console.error("Error playing the video.");
      // errorMessage.style.display = 'block'; // Commented this out to prevent pop-up
    }

    // Unified function to play a media item (movie or ad)
    function playMedia(item) {
      const mainV = videoPlayer;

      // Hide error on new attempt
      errorMessage.style.display = 'none';

      // Destroy previous HLS instance if any
      if (hlsInstance) {
        hlsInstance.destroy();
        hlsInstance = null;
      }

      // Check if source is a m3u8 (HLS stream) or mp4, and handle accordingly
      if (item.src.endsWith(".m3u8")) {
        if (Hls.isSupported()) {
          hlsInstance = new Hls();
          hlsInstance.loadSource(item.src);
          hlsInstance.attachMedia(mainV);
          hlsInstance.on(Hls.Events.MANIFEST_PARSED, function () {
            mainV.play().catch(handleVideoError);
          });
          hlsInstance.on(Hls.Events.ERROR, function (event, data) {
            if (data.fatal) {
              console.error("Fatal HLS error:", data);
              handleVideoError();
            }
          });
        } else if (mainV.canPlayType('application/vnd.apple.mpegurl')) {
          // Native HLS support (Safari)
          mainV.src = item.src;
          mainV.play().catch(handleVideoError);
        } else {
          console.error("HLS is not supported in this browser");
          handleVideoError();
        }
      } else {
        // For MP4 and other standard formats
        mainV.src = item.src;
        mainV.muted = false;
        mainV.play().catch(handleVideoError);
      }

      mainV.onerror = handleVideoError;
    }

    // Function to load a movie
    function loadMovie(movie) {
      const movieInfo = document.getElementById('movieInfo');

      // Reset error message
      errorMessage.style.display = 'none';

      // Hide Title, Logo, and PG info when ad is playing
      if (isAdPlaying) {
        movieInfo.style.display = 'none';
        document.getElementById('logo').style.display = 'none';
        pgInfo.style.display = 'none';
      } else {
        movieInfo.style.display = 'block';
        document.getElementById('logo').style.display = 'block';
        pgInfo.style.display = 'block';
        // Check if it's a GIATV movie (not showing title/logo/PG)
        if (movie.isGiatv) {
          movieInfo.innerHTML = "";  // No title for GIATV movies
          pgInfo.style.display = 'none';  // Hide PG info for GIATV movies
        } else {
          movieInfo.innerHTML = movie.title;  // Show the movie title
          pgInfo.innerHTML = movie.pg;  // Show just the "Parental Guidance" text
        }
      }

      // Play the media using the helper
      playMedia(movie);
    }

    // Video 'ended' event: decide if we show ad or play next movie
    videoPlayer.addEventListener('ended', function () {
      if (!isAdPlaying) {
        showAd();
      } else {
        playNextMovie();
      }
    });

    // Show Ad after movie ends
    function showAd() {
      const adContainer = document.getElementById('adContainer');
      adContainer.style.display = 'block';  // Show the ad
      isAdPlaying = true;

      // Hide title, logo, and PG info during ad
      document.getElementById('movieInfo').style.display = 'none';
      document.getElementById('logo').style.display = 'none';
      pgInfo.style.display = 'none';

      // Play current ad using the same helper
      playMedia(adsList[adIndex]);
    }

    // Play the next movie after the ad ends
    function playNextMovie() {
      const adContainer = document.getElementById('adContainer');
      adIndex = (adIndex + 1) % adsList.length;  // Loop through the ads
      adContainer.style.display = 'none';  // Hide the ad
      isAdPlaying = false;

      currentMovieIndex = (currentMovieIndex + 1) % moviesList.length;  // Loop through the movie list
      loadMovie(moviesList[currentMovieIndex]);
    }

    // Fullscreen toggle function
    function toggleFullScreen() {
      const video = videoPlayer;
      if (!document.fullscreenElement) {
        if (video.requestFullscreen) {
          video.requestFullscreen();
        } else if (video.mozRequestFullScreen) { // Firefox
          video.mozRequestFullScreen();
        } else if (video.webkitRequestFullscreen) { // Chrome and Safari
          video.webkitRequestFullscreen();
        } else if (video.msRequestFullscreen) { // IE/Edge
          video.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    }

    // Load the first movie in the list by default
    loadMovie(moviesList[currentMovieIndex]);
  </script>
</body>
</html>
